<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AI Growth Hub ‚Äì Health Research AI</title>

<style>
/* ================= THEME VARIABLES ================= */
:root {
  --bg: #0f172a;
  --sidebar: #020617;
  --border: #1e293b;
  --text: #e5e7eb;
  --bot: #020617;
  --input: #020617;
  --primary: #2563eb;
}

/* ===== LIGHT THEME ===== */
body.light {
  --bg: #f4f6fb;
  --sidebar: #ffffff;
  --border: #d1d5db;
  --text: #111827;
  --bot: #ffffff;
  --input: #ffffff;
  --primary: #2563eb;
}

/* ================= BASE ================= */
body {
  margin: 0;
  font-family: system-ui, sans-serif;
  background: var(--bg);
  height: 100vh;
  display: flex;
  color: var(--text);
}

/* ===== SIDEBAR ===== */
.sidebar {
  width: 260px;
  background: var(--sidebar);
  border-right: 1px solid var(--border);
  padding: 14px;
  overflow-y: auto;
}

.sidebar button {
  width: 100%;
  margin-bottom: 10px;
  padding: 10px;
  background: var(--primary);
  border: none;
  border-radius: 10px;
  color: white;
  cursor: pointer;
}

.chat-link {
  display: block;
  padding: 8px;
  margin-bottom: 6px;
  border-radius: 8px;
  color: var(--text);
  text-decoration: none;
}

.chat-link.active {
  background: var(--border);
}

/* ===== MAIN ===== */
.main {
  flex: 1;
  display: flex;
  flex-direction: column;
}

header {
  padding: 12px 16px;
  border-bottom: 1px solid var(--border);
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-weight: bold;
}

.header-controls {
  display: flex;
  gap: 8px;
  align-items: center;
}

/* ===== CHAT ===== */
.chat-area {
  flex: 1;
  padding: 20px;
  overflow-y: auto;
}

.message {
  max-width: 70%;
  padding: 12px 16px;
  border-radius: 18px;
  margin-bottom: 12px;
  line-height: 1.6;
  white-space: pre-wrap;
}

.user {
  background: var(--primary);
  color: white;
  margin-left: auto;
  border-bottom-right-radius: 6px;
}

.bot {
  background: var(--bot);
  border: 1px solid var(--border);
  margin-right: auto;
  border-bottom-left-radius: 6px;
}

/* ===== INPUT ===== */
.input-bar {
  display: flex;
  padding: 14px;
  border-top: 1px solid var(--border);
}

input {
  flex: 1;
  padding: 12px 16px;
  border-radius: 20px;
  border: 1px solid var(--border);
  background: var(--input);
  color: var(--text);
  outline: none;
}

button.send,
button.voice,
button.theme {
  margin-left: 8px;
  border-radius: 50%;
  padding: 10px 14px;
  background: var(--primary);
  border: none;
  color: white;
  cursor: pointer;
}

select {
  background: var(--input);
  color: var(--text);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 6px;
}
</style>
</head>

<body>

<div class="sidebar">
  <button onclick="newChat()">‚ûï New Chat</button>
  {% for cid in conversations %}
    <a class="chat-link {% if cid == active_chat %}active{% endif %}"
       href="/switch_chat/{{ cid }}">
      Chat {{ loop.index }}
    </a>
  {% endfor %}
</div>

<div class="main">
<header>
  ü©∫ AI Growth Hub ‚Äì Health Research AI
  <div class="header-controls">
    <button class="theme" onclick="toggleTheme()" id="themeBtn">üåô</button>
    <select id="voiceSelect"></select>
    <button onclick="toggleVoice()" id="voiceBtn">üîä</button>
  </div>
</header>

<div class="chat-area" id="chat">
  {% for m in conversations[active_chat] %}
    <div class="message {{ 'user' if m.role == 'user' else 'bot' }}">
      {{ m.content }}
    </div>
  {% endfor %}
</div>

<div class="input-bar">
  <input id="message" placeholder="Ask a medical research question...">
  <button class="send" onclick="sendMessage()">‚û§</button>
  <button class="voice" onclick="startVoice()">üéôÔ∏è</button>
</div>
</div>

<script>
/* ================= THEME ================= */
const themeBtn = document.getElementById("themeBtn");

function setTheme(mode) {
  document.body.className = mode;
  localStorage.setItem("theme", mode);
  themeBtn.textContent = mode === "light" ? "üåû" : "üåô";
}
function toggleTheme() {
  setTheme(document.body.classList.contains("light") ? "" : "light");
}
setTheme(localStorage.getItem("theme") || "");

/* ================= VOICE ================= */
const synth = window.speechSynthesis;
const voiceSelect = document.getElementById("voiceSelect");
let voices = [];
let voiceEnabled = true;

function loadVoices() {
  voices = synth.getVoices();
  voiceSelect.innerHTML = "";
  voices.filter(v => v.lang.startsWith("en")).forEach((v, i) => {
    const o = document.createElement("option");
    o.value = i;
    o.textContent = v.name;
    voiceSelect.appendChild(o);
  });
}
synth.onvoiceschanged = loadVoices;

function speak(text) {
  if (!voiceEnabled) return;
  synth.cancel();
  const u = new SpeechSynthesisUtterance(text);
  u.voice = voices[voiceSelect.value] || null;
  synth.speak(u);
}

/* ================= CHAT ================= */
function appendMessage(text, role) {
  const div = document.createElement("div");
  div.className = "message " + (role === "user" ? "user" : "bot");
  div.textContent = text;
  document.getElementById("chat").appendChild(div);
  document.getElementById("chat").scrollTop =
    document.getElementById("chat").scrollHeight;
}

async function sendMessage() {
  const input = document.getElementById("message");
  const text = input.value.trim();
  if (!text) return;

  appendMessage(text, "user");
  input.value = "";

  const res = await fetch("/get_response", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({message: text})
  });

  const data = await res.json();
  appendMessage(data.bot, "bot");
  speak(data.bot);
}

function startVoice() {
  if (!('webkitSpeechRecognition' in window)) return alert("Not supported");
  const r = new webkitSpeechRecognition();
  r.lang = "en-US";
  r.start();
  r.onresult = e => document.getElementById("message").value =
    e.results[0][0].transcript;
}

function toggleVoice() {
  voiceEnabled = !voiceEnabled;
  document.getElementById("voiceBtn").textContent =
    voiceEnabled ? "üîä" : "üîá";
  if (!voiceEnabled) synth.cancel();
}

async function newChat() {
  await fetch("/new_chat", { method: "POST" });
  location.reload();
}
</script>

</body>
</html>
